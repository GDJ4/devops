# Практическая работа 7.1 — Terraform + GitHub

Конфигурация Terraform создает и настраивает репозиторий GitHub: задает имя/описание/лицензию, приватность, ветку по умолчанию, защиту ветки (подписанные коммиты, ревью, статус-чеков), коллабораторов, CODEOWNERS (опционально) и вебхуки.

## Что в проекте
- `main.tf` — провайдер GitHub, репозиторий, защита ветки, коллабораторы, вебхуки, CODEOWNERS.
- `variables.tf` — параметры конфигурации.
- `outputs.tf` — ссылки на созданный репозиторий и вспомогательные данные.
- `terraform.tfvars.example` — пример значений переменных.

## Подготовка
1. Установите Terraform (официальный способ или скриптом из `scripts/build.sh`, см. методичку).
2. Создайте GitHub Personal Access Token с правами `repo`, `admin:repo_hook`, `admin:org` (для организации) и сохраните его.
3. Склонируйте этот каталог и скопируйте пример переменных:
   ```bash
   cp terraform.tfvars.example terraform.tfvars
   ```
4. Заполните `terraform.tfvars`:
   - `github_token` — ваш PAT (можно вместо файла экспортировать `TF_VAR_github_token`).
   - `github_owner` — пользователь или организация, на которую создается репозиторий.
   - `repository_name`/`repository_description`/`repository_visibility` — основные параметры репозитория.
   - `default_branch` — ветка по умолчанию (`main`). Если хотите другое имя, создайте такую ветку вручную до `terraform apply` или после создания репозитория поменяйте ее в GitHub и в переменной.
   - `license_template` — шаблон лицензии (`mit`, `apache-2.0` и т.д.).
   - `collaborators` — список пользователей и их прав (`pull`, `triage`, `push`, `maintain`, `admin`).
   - `webhooks` — URL/события/секреты для интеграций.
   - `codeowners` + `require_code_owner_reviews = true` — если нужно защищать конкретные пути через CODEOWNERS.
   - `required_status_checks` — статусы CI, которые должны пройти перед merge (например, `ci/build`).

## Запуск Terraform
```bash
terraform init
terraform plan    # проверить план изменений
terraform apply   # создать/настроить репозиторий
```
Что делает конфигурация:
- создает публичный или приватный репозиторий с выбранной лицензией и темами;
- настраивает ветку по умолчанию и включает удаление веток после merge;
- включает защиту ветки: подписанные коммиты, линейную историю, ревью (и, при желании, code owners) и статус-чеков;
- добавляет коллабораторов с нужными правами;
- настраивает вебхуки для автоматизаций;
- при наличии `codeowners` создаст `.github/CODEOWNERS` (до включения защиты ветки).

> В конфигурации `github_repository` стоит `prevent_destroy = true`, чтобы Terraform не удалил репозиторий. Если нужно удалить его через `terraform destroy`, временно уберите этот блок.

## Проверка результата
- Убедитесь, что репозиторий создан и доступен по SSH (`outputs` покажет ssh/http/html URL).
- Проверьте защиту ветки по умолчанию в GitHub: подписанные коммиты, запрет force push, требования ревью/статус-чеков.
- Проверьте наличие коллабораторов, вебхуков и файла `.github/CODEOWNERS` (если включали).

## Что добавить в отчет
- Скриншоты `terraform plan` и `terraform apply`.
- Скриншот созданного репозитория в GitHub.
- Скриншоты настроек защиты ветки, списка коллабораторов и вебхуков.
